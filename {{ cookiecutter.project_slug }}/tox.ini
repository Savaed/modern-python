[tox]
min_version = 4.0
requires =
    tox=={{ cookiecutter.tox_version }}
    poetry=={{ cookiecutter.poetry_version }}
env_list =
    py{{ cookiecutter.__python_version_str }}
    sanity-check  # Can be deleted

[testenv]
skip_install = true
allowlist_externals = poetry
commands_pre =
    poetry install
commands =
    poetry run coverage erase
    poetry run coverage run -m pytest {posargs:tests}
    poetry run coverage report
    poetry run coverage xml

# The 'sanity-check' environment is only for testing the project
# generated by the cookiecutter and can be safely deleted.
[testenv:sanity-check]
base_python = py{{ cookiecutter.__python_version_str }}
skip_install = true
allowlist_externals =
    git
    poetry
deps = pre-commit
commands_pre =
    poetry install
    git init
    git add .
    pre-commit install
commands =
    poetry run {{ cookiecutter.project_slug | replace('_', '-') }}-test
    pre-commit run --all-files --show-diff-on-failure

[pep8]
ignore = E265,E501,W504
